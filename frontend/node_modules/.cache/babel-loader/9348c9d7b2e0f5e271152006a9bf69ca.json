{"ast":null,"code":"var _jsxFileName = \"/home/niemand/Python/massiliarp/frontend/src/components/Login.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport { BACKEND_URL } from '../App';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Login = ({\n  setCsrf,\n  setIsAuthenticated\n}) => {\n  _s();\n\n  // State\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loggedIn, setLoggedIn] = useState(false);\n\n  const getCSRF = () => {\n    fetch(BACKEND_URL + '/api-auth/csrf/', {\n      credentials: 'include'\n    }).then(res => {\n      const csrfToken = res.headers.get('X-CSRFToken');\n      if (csrfToken !== null) setCsrf(csrfToken);\n      console.log(csrfToken); // -2\n    });\n  };\n\n  useEffect(() => {\n    getSession();\n  }, []);\n\n  const getSession = () => {\n    fetch(BACKEND_URL + '/api-auth/session/', {\n      credentials: 'include'\n    }).then(res => res.json()).then(data => {\n      console.log(data); // -2\n\n      if (data.isAuthenticated) {\n        setIsAuthenticated(true);\n      } else {\n        setIsAuthenticated(false);\n        getCSRF();\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const isResponseOk = response => {\n    if (response.status >= 200 && response.status <= 299) {\n      return response.json();\n    } else {\n      throw Error(response.statusText);\n    }\n  };\n\n  const onLoginSubmit = event => {\n    event.preventDefault();\n    fetch(BACKEND_URL + '/api-auth/login/', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        username: username,\n        password: password\n      })\n    }).then(res => isResponseOk(res)).then(data => {\n      console.log(data);\n      setIsAuthenticated(true);\n      setUsername('');\n      setPassword('');\n      setLoggedIn(true);\n    }).catch(err => {\n      console.log(err);\n      setError(err);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [error.length > 0 && /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: onLoginSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"username\",\n        children: \"Username\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"username\",\n        className: \"bg-gray-200\",\n        onChange: e => {\n          setUsername(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        id: \"password\",\n        className: \"bg-gray-200\",\n        onChange: e => {\n          setPassword(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"submit\",\n        value: \"Login\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this), loggedIn && /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/home\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 27\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Login, \"rh/Jm3uy+yCos5UOwpT+zjzIa8Q=\");\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/home/niemand/Python/massiliarp/frontend/src/components/Login.tsx"],"names":["React","useState","useEffect","Redirect","BACKEND_URL","Login","setCsrf","setIsAuthenticated","username","setUsername","password","setPassword","error","setError","loggedIn","setLoggedIn","getCSRF","fetch","credentials","then","res","csrfToken","headers","get","console","log","getSession","json","data","isAuthenticated","catch","err","isResponseOk","response","status","Error","statusText","onLoginSubmit","event","preventDefault","method","body","JSON","stringify","length","e","target","value"],"mappings":";;;AAAA,OAAOA,KAAP,IAAoBC,QAApB,EAA8BC,SAA9B,QAA+C,OAA/C;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,SAASC,WAAT,QAA4B,QAA5B;;;AAOA,MAAMC,KAAgB,GAAG,CAAC;AAAEC,EAAAA,OAAF;AAAWC,EAAAA;AAAX,CAAD,KAAqC;AAAA;;AAC1D;AACA,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BR,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACS,QAAD,EAAWC,WAAX,IAA0BV,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACW,KAAD,EAAQC,QAAR,IAAoBZ,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACa,QAAD,EAAWC,WAAX,IAA0Bd,QAAQ,CAAC,KAAD,CAAxC;;AAEA,QAAMe,OAAO,GAAG,MAAM;AAClBC,IAAAA,KAAK,CAACb,WAAW,GAAG,iBAAf,EAAkC;AACnCc,MAAAA,WAAW,EAAE;AADsB,KAAlC,CAAL,CAGCC,IAHD,CAGMC,GAAG,IAAI;AACT,YAAMC,SAAS,GAAGD,GAAG,CAACE,OAAJ,CAAYC,GAAZ,CAAgB,aAAhB,CAAlB;AACA,UAAIF,SAAS,KAAK,IAAlB,EACIf,OAAO,CAACe,SAAD,CAAP;AAEJG,MAAAA,OAAO,CAACC,GAAR,CAAYJ,SAAZ,EALS,CAKe;AAC3B,KATD;AAUH,GAXD;;AAaAnB,EAAAA,SAAS,CAAC,MAAM;AACZwB,IAAAA,UAAU;AACb,GAFQ,EAEN,EAFM,CAAT;;AAIA,QAAMA,UAAU,GAAG,MAAM;AACrBT,IAAAA,KAAK,CAACb,WAAW,GAAG,oBAAf,EAAqC;AACtCc,MAAAA,WAAW,EAAE;AADyB,KAArC,CAAL,CAGCC,IAHD,CAGMC,GAAG,IAAIA,GAAG,CAACO,IAAJ,EAHb,EAICR,IAJD,CAIMS,IAAI,IAAI;AACVJ,MAAAA,OAAO,CAACC,GAAR,CAAYG,IAAZ,EADU,CACS;;AACnB,UAAIA,IAAI,CAACC,eAAT,EAA0B;AACtBtB,QAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACH,OAFD,MAEO;AACHA,QAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACAS,QAAAA,OAAO;AACV;AACJ,KAZD,EAaCc,KAbD,CAaOC,GAAG,IAAI;AACVP,MAAAA,OAAO,CAACC,GAAR,CAAYM,GAAZ;AACH,KAfD;AAgBH,GAjBD;;AAmBA,QAAMC,YAAY,GAAIC,QAAD,IAAmB;AACpC,QAAIA,QAAQ,CAACC,MAAT,IAAmB,GAAnB,IAA0BD,QAAQ,CAACC,MAAT,IAAmB,GAAjD,EAAsD;AAClD,aAAOD,QAAQ,CAACN,IAAT,EAAP;AACH,KAFD,MAEO;AACH,YAAMQ,KAAK,CAACF,QAAQ,CAACG,UAAV,CAAX;AACH;AACJ,GAND;;AAQA,QAAMC,aAAa,GAAIC,KAAD,IAA4B;AAC9CA,IAAAA,KAAK,CAACC,cAAN;AACAtB,IAAAA,KAAK,CAACb,WAAW,GAAG,kBAAf,EAAmC;AACpCoC,MAAAA,MAAM,EAAE,MAD4B;AAEpClB,MAAAA,OAAO,EAAE;AACL,wBAAgB;AADX,OAF2B;AAKpCmB,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAACnC,QAAAA,QAAQ,EAAEA,QAAX;AAAqBE,QAAAA,QAAQ,EAAEA;AAA/B,OAAf;AAL8B,KAAnC,CAAL,CAOCS,IAPD,CAOMC,GAAG,IAAIY,YAAY,CAACZ,GAAD,CAPzB,EAQCD,IARD,CAQMS,IAAI,IAAI;AACVJ,MAAAA,OAAO,CAACC,GAAR,CAAYG,IAAZ;AACArB,MAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACAE,MAAAA,WAAW,CAAC,EAAD,CAAX;AACAE,MAAAA,WAAW,CAAC,EAAD,CAAX;AACAI,MAAAA,WAAW,CAAC,IAAD,CAAX;AACH,KAdD,EAeCe,KAfD,CAeOC,GAAG,IAAI;AACVP,MAAAA,OAAO,CAACC,GAAR,CAAYM,GAAZ;AACAlB,MAAAA,QAAQ,CAACkB,GAAD,CAAR;AACH,KAlBD;AAmBH,GArBD;;AAuBA,sBACI;AAAA,eACMnB,KAAK,CAACgC,MAAN,GAAe,CAAf,iBACE;AAAA,gBAAKhC;AAAL;AAAA;AAAA;AAAA;AAAA,YAFR,eAKI;AAAM,MAAA,QAAQ,EAAEyB,aAAhB;AAAA,8BACI;AAAO,QAAA,OAAO,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,eAEI;AAAO,QAAA,IAAI,EAAC,MAAZ;AAAmB,QAAA,EAAE,EAAC,UAAtB;AAAiC,QAAA,SAAS,EAAC,aAA3C;AAAyD,QAAA,QAAQ,EAAEQ,CAAC,IAAI;AAAEpC,UAAAA,WAAW,CAACoC,CAAC,CAACC,MAAF,CAASC,KAAV,CAAX;AAA6B;AAAvG;AAAA;AAAA;AAAA;AAAA,cAFJ,eAGI;AAAO,QAAA,OAAO,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAHJ,eAII;AAAO,QAAA,IAAI,EAAC,UAAZ;AAAuB,QAAA,EAAE,EAAC,UAA1B;AAAqC,QAAA,SAAS,EAAC,aAA/C;AAA6D,QAAA,QAAQ,EAAEF,CAAC,IAAI;AAAElC,UAAAA,WAAW,CAACkC,CAAC,CAACC,MAAF,CAASC,KAAV,CAAX;AAA6B;AAA3G;AAAA;AAAA;AAAA;AAAA,cAJJ,eAKI;AAAO,QAAA,IAAI,EAAC,QAAZ;AAAqB,QAAA,KAAK,EAAC;AAA3B;AAAA;AAAA;AAAA;AAAA,cALJ;AAAA;AAAA;AAAA;AAAA;AAAA,YALJ,EAaMjC,QAAQ,iBAAI,QAAC,QAAD;AAAU,MAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,YAblB;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ;AAiBH,CA3FD;;GAAMT,K;;KAAAA,K;AA6FN,eAAeA,KAAf","sourcesContent":["import React, { FC, useState, useEffect } from 'react'\nimport { Redirect } from 'react-router-dom'\nimport { BACKEND_URL } from '../App'\n\ninterface Props {\n    setCsrf: Function\n    setIsAuthenticated: Function\n}\n\nconst Login: FC<Props> = ({ setCsrf, setIsAuthenticated }) => {\n    // State\n    const [username, setUsername] = useState('')\n    const [password, setPassword] = useState('')\n    const [error, setError] = useState('')\n    const [loggedIn, setLoggedIn] = useState(false)\n\n    const getCSRF = () => {\n        fetch(BACKEND_URL + '/api-auth/csrf/', {\n            credentials: 'include',\n        })\n        .then(res => {\n            const csrfToken = res.headers.get('X-CSRFToken')\n            if (csrfToken !== null)\n                setCsrf(csrfToken)\n\n            console.log(csrfToken)  // -2\n        })\n    }\n\n    useEffect(() => {\n        getSession()\n    }, [])\n\n    const getSession = () => {\n        fetch(BACKEND_URL + '/api-auth/session/', {\n            credentials: 'include',\n        })\n        .then(res => res.json())\n        .then(data => {\n            console.log(data)  // -2\n            if (data.isAuthenticated) {\n                setIsAuthenticated(true)\n            } else {\n                setIsAuthenticated(false)\n                getCSRF()\n            }\n        })\n        .catch(err => {\n            console.log(err)\n        })\n    }\n\n    const isResponseOk = (response: any) => {\n        if (response.status >= 200 && response.status <= 299) {\n            return response.json()\n        } else {\n            throw Error(response.statusText)\n        }\n    }\n\n    const onLoginSubmit = (event: React.FormEvent) => {\n        event.preventDefault()\n        fetch(BACKEND_URL + '/api-auth/login/', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({username: username, password: password}),\n        })\n        .then(res => isResponseOk(res))\n        .then(data => {\n            console.log(data)\n            setIsAuthenticated(true)\n            setUsername('')\n            setPassword('')\n            setLoggedIn(true)\n        })\n        .catch(err => {\n            console.log(err)\n            setError(err)\n        })\n    }\n\n    return (\n        <div>\n            { error.length > 0 &&  \n                <h2>{error}</h2>\n            }\n\n            <form onSubmit={onLoginSubmit}>\n                <label htmlFor=\"username\">Username</label>\n                <input type=\"text\" id=\"username\" className=\"bg-gray-200\" onChange={e => { setUsername(e.target.value) }} />\n                <label htmlFor=\"password\">Password</label>\n                <input type=\"password\" id=\"password\" className=\"bg-gray-200\" onChange={e => { setPassword(e.target.value) }} />\n                <input type=\"submit\" value=\"Login\" />\n            </form>\n\n            { loggedIn && <Redirect to=\"/home\" /> }\n        </div>\n    )\n}\n\nexport default Login\n"]},"metadata":{},"sourceType":"module"}